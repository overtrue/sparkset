#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push validation..."

# è¿è¡Œ lint æ£€æŸ¥ï¼ˆå…è®¸è­¦å‘Šï¼Œåªæ£€æŸ¥é”™è¯¯ï¼‰
echo "ğŸ“ Checking code style..."
pnpm lint --max-warnings=100 || {
  echo "âŒ Lint failed. Please fix the errors before pushing."
  exit 1
}

# è¿è¡Œç±»å‹æ£€æŸ¥
echo "ğŸ” Running type check..."
pnpm --filter @sparkset/server typecheck || {
  echo "âŒ Type check failed. Please fix the type errors before pushing."
  exit 1
}

# è¿è¡Œæµ‹è¯•
echo "ğŸ§ª Running tests..."
pnpm test || {
  echo "âŒ Tests failed. Please fix the failing tests before pushing."
  exit 1
}

# è¿è¡Œæ„å»ºæ£€æŸ¥ï¼ˆç¡®ä¿ä»£ç å¯ä»¥ç¼–è¯‘ï¼‰
echo "ğŸ—ï¸  Checking build..."
pnpm build || {
  echo "âŒ Build failed. Please fix the build errors before pushing."
  exit 1
}

echo "âœ… All validations passed!"

