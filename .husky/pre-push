echo "ğŸ” Running pre-push validation..."

# è¿è¡Œ lint æ£€æŸ¥ï¼ˆåªæ£€æŸ¥ server çš„é”™è¯¯ï¼Œè­¦å‘Šä¸å½±å“ï¼‰
echo "ğŸ“ Checking code style..."
# åªæ£€æŸ¥ server çš„ lint é”™è¯¯ï¼ˆdashboard çš„é”™è¯¯åç»­ä¿®å¤ï¼‰
if ! pnpm --filter @sparkset/server lint --quiet 2>&1 | grep -E "error" > /dev/null; then
  echo "âœ… Server lint check passed"
else
  echo "âŒ Server lint errors found. Please fix the errors before pushing."
  pnpm --filter @sparkset/server lint 2>&1 | grep -E "error" | head -20
  exit 1
fi

# è¿è¡Œç±»å‹æ£€æŸ¥
echo "ğŸ” Running type check..."
pnpm --filter @sparkset/server typecheck || {
  echo "âŒ Type check failed. Please fix the type errors before pushing."
  exit 1
}

# è¿è¡Œæµ‹è¯•
echo "ğŸ§ª Running tests..."
pnpm test || {
  echo "âŒ Tests failed. Please fix the failing tests before pushing."
  exit 1
}

# è¿è¡Œæ„å»ºæ£€æŸ¥ï¼ˆç¡®ä¿ä»£ç å¯ä»¥ç¼–è¯‘ï¼‰
echo "ğŸ—ï¸  Checking build..."
pnpm build || {
  echo "âŒ Build failed. Please fix the build errors before pushing."
  exit 1
}

echo "âœ… All validations passed!"

